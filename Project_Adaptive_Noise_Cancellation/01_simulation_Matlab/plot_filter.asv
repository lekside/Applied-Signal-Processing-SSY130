close all;
clc;
if ~ exist(fullfile(pwd,'images'),'dir'), mkdir images; end


%% Question 2

f_s = 16000;    % Hz
h = flipud(h_reversedOrder);
[H,w] = freqz(h,1,512,f_s); %'whole',


figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter H(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs'),'epsc')

figure('Color','white');
subplot(2,1,1);
plot(w/f_s,20*log10(abs(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Magnitude (dB)', title 'Estimated Filter H(w)'
subplot(2,1,2)
plot(w/f_s, 180/pi*wrapToPi(phase(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Phase (degrees)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','H'),'epsc')


%% Question 3

f_s = 16000;    % Hz
h = [1 0 0 0.5];
[H,w] = freqz(h,1,512,f_s); %'whole',

figure('Color','white');
subplot(2,1,1);
plot(w/f_s,20*log10(abs(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Magnitude (dB)', title 'Frequency response H(w) of h = [1, 0, 0, 0.5]'
subplot(2,1,2)
plot(w/f_s, 180/pi*wrapToPi(phase(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Phase (degrees)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','H-echo'),'epsc')



%% Faraway test

h_reversedOrder = [-.00718983;
        -.00402617;
        -.000801361;
        .000680409;
        -.000735615;
        -.000308743;
        -.00256794;
        -.00358332;
        -.00368673;
        -.00209387;
        2.27476e-5;
        -.00118643;
        -.00268693;
        -.00181499;
        .000396384;
        .0016713;
        .0011743;
        .000266446;
        .000365479;
        .000282021;
        .000219833;
        -.00013394;
        .000260264;
        .00196459;
        .00201544;
        .000340706;
        -.00200686;
        -.00190511;
        -3.94434e-5;
        .00120844;
        .00101514;
        .000127613;
        .000840145;
        .00161283;
        .00156734;
        .001673;
        .00188706;
        .00201419;
        .00177968;
        -8.55823e-5;
        -.00158777;
        -.00138299;
        -.000979397;
        -.000720773;
        -.00116422;
        -.00153197;
        -.00014166;
        .00123238;
        .00155965;
        .00225196;
        .00295699;
        .00182493;
        .000324519;
        -.000734309;
        -.000769461;
        .000794161;
        .00117018;
        -.000166671;
        -.000665864;
        -.000120392;
        .000909775;
        .00101377;
        -.00107777;
        -.0026762;
        -.00254221;
        -.00138006;
        -.000825317;
        -.00225901;
        -.00398465;
        -.00421261;
        -.00266036;
        -.000259165;
        .000952044;
        .000554805;
        .000668341;
        .000756712;
        .000372564;
        .00154322;
        .0026303;
        .001923;
        .0022295;
        .0015109;
        -.00154528;
        -.000951245;
        .000801348;
        .00233384;
        .00282732;
        .000734217;
        -.00150044;
        -.00275621;
        -.00108689;
        .00121728;
        .00152961;
        .000523293;
        -.000186771;
        -.000573564;
        2.1575e-5;
        .00121231;
        .00104973;
        .000452361;
        7.049e-5;
        -.00120888;
        -.00260683;
        -.00267656;
        -.00173821;
        -.00123833;
        -.000806714;
        -.000659541;
        -.00103224;
        .000115354;
        .00143017;
        .00128299;
        .000434468;
        -.00119827;
        -.00214391;
        -.00149987;
        -.000730245;
        .000241769;
        .000629041;
        .000453974;
        .000590519;
        .00133026;
        .00167816;
        .00205026;
        .00199696;
        .00129499;
        -.00030231;
        -.00242458;
        -.00306493;
        -.00163022;
        .000709127;
        .000720647;
        -.000688204;
        -.00226933;
        -.00214499;
        -8.82073e-5;
        .00155985;
        .00266138;
        .00191092;
        -.000180704;
        -.00147424;
        -.00164101;
        -.00162876;
        -.000578387;
        .000731232;
        -.0001622;
        -.000375934;
        -.000487268;
        -.000230123;
        .00184087;
        .00420097;
        .00483247;
        .00310799;
        .00076966;
        -.00146874;
        -.000817911;
        .00222633;
        .00297632;
        .00255198;
        .00285508;
        -.000236433;
        -.000741203;
        .00123091;
        -.00108166;
        .000104011;
        .00190893;
        .000309588;
        -.000155205;
        -.00181435;
        -.00577481;
        -.00428578;
        .00139883;
        .00244656;
        .00330685;
        -.00301235;
        -.00719055;
        -.00346857;
        -.00275218;
        .00154526;
        .00455104;
        .00167645;
        -.00391371;
        -.00427332;
        -.00815431;
        -.00227838;
        .00739335;
        .00489022;
        .00250388;
        -.00668259;
        -.00707239;
        .000788517;
        .0082709;
        .011115;
        .0109517;
        .00127365;
        -.0105789;
        -.00395151;
        .00480097;
        .0205505;
        .0250993;
        .0110201;
        -.0142986;
        -.0248244;
        -.0024581;
        .018413;
        .027568;
        -.000566926;
        -.0304352;
        -.0285748;
        .000401618;
        .0258638;
        .0261824;
        .0169875;
        -.00609553;
        -.00968979;
        -.0191728;
        -.0271175;
        -.00389898;
        .027968;
        .0169505;
        -.0273586;
        -.0597863;
        -.0673948;
        .0106643;
        .0668583;
        .0436839;
        .0173108;
        -.0170144;
        -.020609;
        .00499512;
        .00919291;
        -.00207987;
        -.00655685;
        -.00227347;
        .000421624;
        -.000411088;
        -.000820478;
        .000477691;
        .000941879;
        -6.04197e-5;
        -.000816667;
        -.000630994;
        -.000155723;
        1.125e-5;
        -.000378199;
        -.00027356;
        .000485033;
        .000870682;
        .000491865;
        .000330833;
        .0011273;
        .00220979;
        .00265004;
        .00159264;
        5.78527e-6;
        -.000497905;
        9.74479e-5;
        .000616242;
        .000208527;
        -.000762479;
        -.00078327;
        -.000151433;
        .000279666;
        .000334981;
        .000345422;
        .000592958;
        .000956535;
        .00115453;
        .00105909;
        .000427963;
        -.0003781;
        -.00115044;
        -.00192713;
        -.00235027;
        -.00242312;
        -.00188431;
        -.00132647;
        -.00126015;
        -.00161663;
        -.00204302;
        -.00153002;
        -.000279701;
        .000851791;
        .000741339;
        -.000342532;
        -.0010035;
        -.000471073;
        .000269634;
        .000440503;
        -.000116066;
        -.000802498;
        -.000563363;
        -.000215949;
        .000472455;
        .00169806;
        .0023114;
        .00222315;
        .00152775;
        .000909105;
        .00110515]


%% Data test 2

h_reversedOrder = [-.0162912;
        -.00039049;
        .00158036;
        -.00169076;
        -.0084429;
        -.00415576;
        .000716567;
        .00194811;
        .00116055;
        .00379446;
        .00525885;
        .00410506;
        .000508897;
        -.00018407;
        .00410946;
        .0078935;
        .00750645;
        .00521666;
        .00403269;
        .00236296;
        .000970207;
        .00153835;
        .00215876;
        .00181501;
        .00029229;
        -.000859264;
        -.000601866;
        .00147631;
        .00435689;
        .00511736;
        .00315797;
        .000311181;
        -.000664035;
        -.00110644;
        -.001524;
        .00046037;
        .00199132;
        .00121335;
        -.00130656;
        -.00393997;
        -.00449992;
        -.00304478;
        -.00202984;
        -.00288342;
        -.00509368;
        -.00587262;
        -.00328373;
        -.000157417;
        .00105798;
        .00186443;
        .00266543;
        .00157008;
        9.96082e-6;
        .000361297;
        .00155621;
        .0036058;
        .00592062;
        .00489364;
        .000973396;
        -.00179298;
        -.00133586;
        .00220532;
        .00420534;
        .00252233;
        .000400999;
        -.0017099;
        -.00182747;
        -.000798247;
        -.00177811;
        -.00223493;
        -.00187541;
        -.00174207;
        -.00229901;
        -.00392305;
        -.00352417;
        -.000137608;
        .00484825;
        .0058376;
        .00192286;
        -.000826933;
        -.00374742;
        -.00521932;
        -.00159005;
        .00122137;
        .00258333;
        .00235121;
        -.000265182;
        -.00235785;
        -.00185109;
        .00165942;
        .00533048;
        .0060239;
        .00359352;
        -.000194994;
        -.00338871;
        -.00329298;
        -.000727819;
        .00165079;
        .00213359;
        -.000662158;
        -.0040417;
        -.00447174;
        -.00225948;
        .000457138;
        .000994558;
        -.00106545;
        -.00426785;
        -.00618903;
        -.00526194;
        -.00161446;
        .00223134;
        .00399127;
        .00241525;
        -.00116591;
        -.0034781;
        -.00255339;
        .000143206;
        .00173916;
        .00277646;
        .00206374;
        .000858984;
        .00186509;
        .00360269;
        .00638807;
        .00933944;
        .00776053;
        .00168685;
        -.00330867;
        -.0034594;
        .000674234;
        .00490195;
        .00485627;
        .00126836;
        -.00196071;
        -.00395388;
        -.00291994;
        -.00136578;
        -.00127697;
        -.000953608;
        -.00222061;
        -.00578063;
        -.00750267;
        -.00698584;
        -.00550729;
        -.00229216;
        -.0019281;
        -.00284614;
        -.0058572;
        -.0093848;
        -.00680239;
        -.000232371;
        .00676844;
        .00769922;
        .00252485;
        -.00206665;
        -.00163691;
        .00549161;
        .0130866;
        .0135823;
        .00721944;
        .00102707;
        -.00247379;
        .00138467;
        .00803079;
        .014666;
        .0166235;
        .0108464;
        .00413275;
        -.00436203;
        -.00603093;
        .000904366;
        .0128854;
        .0171992;
        .00567392;
        -.0100324;
        -.0152898;
        -.00202658;
        .0180485;
        .0216839;
        .00705921;
        -.0129274;
        -.0223766;
        -.0117143;
        -.00297595;
        -.00539665;
        -.00414845;
        -.0088357;
        -.0129768;
        -.0178533;
        -.0288916;
        -.0230921;
        -.00809974;
        .00166802;
        .00126281;
        -.0129988;
        -.0344801;
        -.0239348;
        .00282671;
        .0146967;
        .0225702;
        .00637049;
        -.0237316;
        -.0230613;
        -.00535921;
        .015799;
        .0419193;
        .0293567;
        .00367765;
        -.0017339;
        -.00746252;
        .0279297;
        .070734;
        .0471579;
        .0210472;
        -.00559411;
        -.0220374;
        .0105907;
        .0305642;
        .0365482;
        .0436213;
        .0194768;
        -.0200907;
        -.0287377;
        -.00210292;
        .0466563;
        .0809624;
        -.0110649;
        -.127572;
        -.0980424;
        -.0147348;
        .0720149;
        .0680417;
        -.00268214;
        -.0066643;
        -.0262754;
        -.0638592;
        -.057932;
        -.0348042;
        .0156687;
        .00620044;
        -.182756;
        -.319952;
        -.197549;
        .109902;
        .322941;
        .245808;
        .0685062;
        -.0489445;
        -.0520764;
        .0286488;
        .0396501;
        -.0143223;
        -.0276884;
        .00227138;
        .015715;
        .000673954;
        -.0088989;
        -.00311777;
        .00202678;
        4.75698e-5;
        -.00179456;
        -.000385098;
        .000713149;
        5.71524e-5;
        -.00104902;
        -.000961896;
        -.000396768;
        -.000560578;
        -.00129254;
        -.00105944;
        .000707013;
        .00195101;
        .000956526;
        -.000148884;
        .000953234;
        .00234288;
        .00208623;
        -.00015397;
        -.00180268;
        -.00128564;
        .00121443;
        .00253372;
        .0010024;
        -.00072277;
        -.000240532;
        .00138732;
        .00139034;
        -.000378893;
        -.00212351;
        -.00200444;
        -.000452854;
        .000318861;
        -.000448464;
        -.00100908;
        -.000466418;
        1.62262e-5;
        -.00084361;
        -.000627253;
        .000555247;
        .00101575];


%% Data

h_reversedOrder = [.00445054;
        .00268517;
        .00236062;
        .00205561;
        .0033158;
        .00122588;
        -.000854964;
        -.00228341;
        -.00225008;
        -.00319242;
        -.00498356;
        -.00541499;
        -.00608976;
        -.00807306;
        -.00984606;
        -.0118467;
        -.0140735;
        -.0149168;
        -.0154661;
        -.0159543;
        -.014817;
        -.0133813;
        -.011975;
        -.0102288;
        -.00887166;
        -.00665469;
        -.00309712;
        -.000104292;
        .00229496;
        .00395937;
        .00417979;
        .00453211;
        .00522242;
        .00497828;
        .00518842;
        .00640411;
        .00675384;
        .00767529;
        .00845077;
        .00849982;
        .00988955;
        .0111011;
        .0116841;
        .0128981;
        .0125077;
        .0107036;
        .00952941;
        .00780504;
        .00594851;
        .00484007;
        .00324283;
        .00168149;
        .00113752;
        .00106657;
        .000822002;
        -.000315935;
        -.0015408;
        -.00155708;
        -.000877104;
        -.000746788;
        -.00114234;
        -.0021341;
        -.00329717;
        -.0047386;
        -.00599206;
        -.0071219;
        -.00848624;
        -.00818671;
        -.00731587;
        -.00773025;
        -.0082902;
        -.00780116;
        -.00712318;
        -.00613381;
        -.0043929;
        -.00288943;
        -.00226534;
        -.00113893;
        -.000346911;
        .00129998;
        .00446565;
        .00766063;
        .0110212;
        .0135755;
        .014571;
        .015811;
        .0174364;
        .0179002;
        .0182377;
        .0180191;
        .0165255;
        .0138137;
        .0101402;
        .00647717;
        .00344898;
        .000431724;
        -.00267203;
        -.00762005;
        -.013333;
        -.0179124;
        -.0206202;
        -.0205455;
        -.0209967;
        -.0225961;
        -.0239128;
        -.0256154;
        -.0267164;
        -.0265827;
        -.0275177;
        -.0284898;
        -.0274152;
        -.0246107;
        -.0204401;
        -.0154447;
        -.0106942;
        -.00567106;
        .000744418;
        .0065465;
        .0104839;
        .0143431;
        .0186508;
        .0239396;
        .0309559;
        .0352989;
        .0360795;
        .0365171;
        .0365703;
        .0384469;
        .0404724;
        .0380521;
        .0342519;
        .0289082;
        .0225699;
        .0187729;
        .0152938;
        .0100318;
        .0042679;
        -.00194255;
        -.00956137;
        -.0168166;
        -.02122;
        -.0244905;
        -.0270471;
        -.029575;
        -.0343959;
        -.0389619;
        -.0432595;
        -.0461275;
        -.0451793;
        -.0446704;
        -.0458523;
        -.0465456;
        -.0490317;
        -.0489447;
        -.0409457;
        -.0284468;
        -.0134154;
        .00151428;
        .0138338;
        .0269425;
        .0391046;
        .0469419;
        .0534757;
        .0607064;
        .0644532;
        .0653665;
        .070036;
        .0700678;
        .065798;
        .0710966;
        .0695608;
        .0549614;
        .0452596;
        .0317968;
        .0191715;
        .0190735;
        .0128655;
        .00539201;
        -.00433363;
        -.0243432;
        -.0291957;
        -.0364253;
        -.0632379;
        -.0750547;
        -.0807785;
        -.0935169;
        -.0925162;
        -.0870014;
        -.0984576;
        -.0985536;
        -.0756196;
        -.0780724;
        -.0860528;
        -.0907456;
        -.106068;
        -.087592;
        -.0636494;
        -.0563351;
        -.0240183;
        -.00916932;
        -.00909597;
        .0445026;
        .0749544;
        .083173;
        .117894;
        .123472;
        .123676;
        .130787;
        .153919;
        .159017;
        .139613;
        .147526;
        .120244;
        .0817239;
        .0848538;
        .0666217;
        .059394;
        .0668237;
        .025461;
        .0329314;
        .031194;
        -.0058682;
        .0376348;
        .0287946;
        -.035913;
        -.0774374;
        -.112994;
        -.142288;
        -.109348;
        -.0498777;
        -.123458;
        -.147955;
        -.130176;
        -.194274;
        -.16258;
        -.132608;
        -.189855;
        -.0824426;
        .0170031;
        -.0271267;
        .0962772;
        .163774;
        .14377;
        .226885;
        .15799;
        .0175698;
        -.010932;
        -.0288274;
        -.0284919;
        -.00531208;
        -.00789862;
        -.0171808;
        -.01645;
        -.00965764;
        -.0099488;
        -.0138862;
        -.0142755;
        -.0109849;
        -.00874365;
        -.00719632;
        -.00488669;
        -.00260423;
        -.00113108;
        -.00026269;
        .000126015;
        .000655633;
        .00178229;
        .0027328;
        .00418287;
        .00591617;
        .00819609;
        .0108869;
        .0115055;
        .0107672;
        .0100186;
        .00905009;
        .00872154;
        .00852264;
        .00821875;
        .00903033;
        .00972073;
        .0096287;
        .0100584;
        .00929687;
        .00837558;
        .00823506;
        .00693871;
        .00587493;
        .00564808;
        .00621069;
        .00714758;
        .00770485;
        .00806036;
        .0074385;
        .00566642;
        .00293808;
        .00108552;
        .000248962;
        .00153468;
        .00392912];